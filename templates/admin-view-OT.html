<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin View Overtime</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        body {
            background-color: #f4e7f5; /* Pastel purple background */
            color: #5c4b51; /* Complementary text color */
        }

        h1 {
            color: #4e2a68; /* Darker pastel purple for headings */
            text-align: center;
        }

        .form-label {
            color: #4e2a68; /* Matching label colors */
        }

        .form-control, .form-select {
            border-color: #cdb4db;
            background-color: #fff;
            color: #4e2a68;
        }

        .form-control:focus, .form-select:focus {
            border-color: #b185d6;
            box-shadow: 0 0 5px #b185d6;
        }

        table {
            background-color: #ffffff;
            border: 1px solid #cdb4db;
            color: #5c4b51;
        }

        th {
            background-color: #d4a5db;
            color: #ffffff;
        }

        tr:nth-child(even) {
            background-color: #f7ebf9;
        }

        tr:hover {
            background-color: #e7d9ef;
        }

        .container {
            background-color: #ffffff;
            border: 1px solid #cdb4db;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        a {
            color: #6c2ea0;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
            color: #4e2a68;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Admin Overtime View</h1>
    <div class="mb-3">
    <label for="search_query" class="form-label">Search by Faculty Name or ID</label>
    <input type="text" id="search_query" class="form-control" placeholder="Enter faculty name or ID">
</div>
    <div class="mb-3">
        <label for="date_range" class="form-label">Select Date Range</label>
        <select id="date_range" class="form-select">
            <option value="week" selected>This Week</option>
            <option value="month">This Month</option>
            <option value="custom">Custom Range</option>
        </select>
    </div>
    <div class="mb-3" id="custom_range" style="display: none;">
        <label for="start_date" class="form-label">Start Date</label>
        <input type="date" id="start_date" class="form-control">
        <label for="end_date" class="form-label mt-3">End Date</label>
        <input type="date" id="end_date" class="form-control">
    </div>
    <table class="table mt-3">
        <thead>
        <tr>
            <th>Faculty Name</th>
            <th>Total Hours</th>
        </tr>
        </thead>
        <tbody id="faculty_table">
        </tbody>
    </table>
</div>

<script>
    let searchTimeout; // Timer for debouncing

$(document).ready(function () {
    // Attach event listeners
    $('#search_query').on('keyup', function () {
        clearTimeout(searchTimeout); // Clear the previous timer
        searchTimeout = setTimeout(() => {
            fetchOvertime(); // Call the fetch function after a delay
        }, 300); // 300ms debounce delay
    });

    $('#date_range, #start_date, #end_date').on('change', function () {
        fetchOvertime(); // Fetch data when date filters are changed
    });

    // Show or hide custom date range fields
    $('#date_range').on('change', function () {
        const value = $(this).val();
        if (value === 'custom') {
            $('#custom_range').show();
        } else {
            $('#custom_range').hide();
            $('#start_date').val('');
            $('#end_date').val('');
        }
    });

    // Fetch data initially when the page loads
    fetchOvertime();
});

function fetchOvertime() {
    const search_query = $('#search_query').val().trim();
    const range = $('#date_range').val();
    const start_date = $('#start_date').val();
    const end_date = $('#end_date').val();

    // Show a loading indicator (optional)
    const tbody = $('#faculty_table');
    tbody.html('<tr><td colspan="2">Loading...</td></tr>');

    // Send a GET request to the backend
    $.get('/get_overtime', { search_query, range, start_date, end_date }, function (data) {
        tbody.empty(); // Clear the loading message

        if (data.length === 0) {
            tbody.append('<tr><td colspan="2">No records found</td></tr>');
        } else {
            data.forEach(item => {
                tbody.append(`<tr>
                    <td><a href="#" onclick="viewDetails('${item.faculty_id}', '${range}', '${start_date}', '${end_date}')">${item.faculty_name}</a></td>
                    <td>${item.total_hours.toFixed(2)} hours</td>
                </tr>`);
            });
        }
    });
}

function viewDetails(email, range, start_date, end_date) {
    $.get('/get_faculty_overtime_details', { email, start_date, end_date }, function (data) {
        let details = data.map(record => `
            <p><strong>Date:</strong> ${record.date}</p>
            <p><strong>Start:</strong> ${record.start_time}</p>
            <p><strong>End:</strong> ${record.end_time}</p>
            <p><strong>Hours:</strong> ${record.hours_worked}</p>
            <p><strong>Description:</strong> ${record.description}</p>
            <hr>
        `).join('');
        alert(details);
    });
}

</script>
</body>
</html>
